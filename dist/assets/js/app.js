'use strict';

function addClass(element, className) {
  if (element.classList) element.classList.add(className);else element.className += ' ' + className;
}

function removeClass(element, className) {
  if (element.classList) element.classList.remove(className);else element[className] = element[className].replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
}
'use strict';

function congratsCount(congrat, container) {
  var span = document.createElement('span');
  var gramm = function gramm(congrat) {
    var string = 'поздравлений';
    if (congrat % 100 < 11 || congrat % 100 > 14) {
      switch (congrat % 10) {
        case 1:
          string = 'поздравление';break;
        case 2:
        case 3:
        case 4:
          string = 'поздравления';break;
      }
    }
    return string;
  };
  //todo separate span and word "gramm"
  span.className = 'congrats-count';
  span.innerHTML = congrat + ' ' + gramm(congrat);
  container.appendChild(span);
}
'use strict';

function countdown(toDate) {
    var final = new Date(toDate);

    var remained = function remained() {
        var now = new Date();
        var diff = final - now;

        var remain = {
            daysRemain: null,
            hoursRemain: null,
            minutesRemain: null
        };

        var minutes = 60000,
            hours = minutes * 60,
            days = hours * 24;

        function leadZero(number) {
            var num = number + '';
            if (num.length <= 1) {
                return '0' + num;
            } else {
                return num;
            }
        }

        remain.daysRemain = leadZero(Math.floor(diff / days));
        remain.hoursRemain = leadZero(Math.floor(diff % days / hours));
        remain.minutesRemain = leadZero(Math.floor(diff % hours / minutes));

        document.getElementById('days').innerText = remain.daysRemain;
        document.getElementById('hours').innerText = remain.hoursRemain;
        document.getElementById('minutes').innerText = remain.minutesRemain;
    };

    var counter = setInterval(remained, 1000);
}
'use strict';

;!function () {
  var submit = document.getElementById('submit');
  var form = document.getElementById('form-congratulate');
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    //counting submits = number of congratulations
    var congratCount = localStorage.getItem('trexCongrats');
    if (congratCount === null) congratCount = 0;
    congratCount++;
    localStorage.setItem('trexCongrats', congratCount);
    //send form
    var request = new XMLHttpRequest();
    request.open(form.method, form.action, true);
    request.onload = function () {
      var resp = null;
      if (request.status >= 200 && request.status < 400) {
        resp = request.responseText;
        document.getElementById('modal-body').innerHTML = resp;
        var trexCongratContainer = document.getElementById('congrats-count');
        //counting congratulations and store into container
        congratsCount(localStorage.getItem('trexCongrats'), trexCongratContainer);
      } else {
        console.log('wrong request');
      }
    };
    request.onerror = function () {
      console.log('problems of some sort');
    };
    //todo validate on keyup
    if (validation(form)) {
      request.send();
    }
  });
}();
'use strict';

;!function () {
  var modal = document.getElementById('modal');
  var modalOpenBtn = document.getElementById('modal-open');
  var closeModalBtn = document.querySelectorAll('.js-close-modal');
  var docBody = document.body;
  modalOpenBtn.addEventListener('click', function () {
    modal.style.display = 'block';
    addClass(docBody, 'is-modal-open');
  });
  //todo close modal by clicking overlay
  [].forEach.call(closeModalBtn, function (elem) {
    elem.addEventListener('click', function () {
      modal.style.display = 'none';
      removeClass(docBody, 'is-modal-open');
    });
  });
}();
'use strict';

;!function () {
  var slider = document.getElementById('slider'),
      nextBtn = document.getElementById('next'),
      prevBtn = document.getElementById('prev'),
      slides = slider.getElementsByTagName('li'),
      counter = 0;

  function showImage(index) {
    [].forEach.call(slides, function (elem) {
      removeClass(elem, 'slider__item--active');
    });
    addClass(slides[index], 'slider__item--active');
  }

  function nextImg() {
    if (counter < slides.length - 1) {
      counter += 1;
    } else {
      counter = 0;
    }
    showImage(counter);
  }

  function prevImg() {
    if (counter > 0) {
      counter -= 1;
    } else {
      counter = slides.length - 1;
    }
    showImage(counter);
  }

  window.setInterval(prevImg, 6000);

  nextBtn.onclick = nextImg;
  prevBtn.onclick = prevImg;
}();
'use strict';

function validation(form) {
    var formArray = form.elements;
    var valid = true;
    var message = 'Заполните это поле!';
    var errorContainer = document.createElement('div');
    errorContainer.innerHTML = message;
    for (var i = 0; i < formArray.length; i++) {
        if (formArray[i].hasAttribute('required') && formArray[i].value == '') {
            if (formArray[i].classList) formArray[i].classList.add('form-input--invalid');else formArray[i].className += ' form-input--invalid';
            valid = false;
        }
    }
    return valid;
}
'use strict';

countdown('September 24, 2016 24:00:00');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwuanMiLCJjb25ncmF0cy1jb3VudC5qcyIsImNvdW50ZG93bi5qcyIsImZvcm0uanMiLCJtb2RhbC5qcyIsInNsaWRlci5qcyIsInZhbGlkYXRpb24uanMiLCJhcHAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxTQUFTLFFBQVQsQ0FBa0IsT0FBbEIsRUFBMkIsU0FBM0IsRUFBc0M7QUFDcEMsTUFBSSxRQUFRLFNBQVosRUFDRSxRQUFRLFNBQVIsQ0FBa0IsR0FBbEIsQ0FBc0IsU0FBdEIsRUFERixLQUdFLFFBQVEsU0FBUixJQUFxQixNQUFNLFNBQTNCO0FBQ0g7O0FBRUQsU0FBUyxXQUFULENBQXFCLE9BQXJCLEVBQThCLFNBQTlCLEVBQXlDO0FBQ3ZDLE1BQUksUUFBUSxTQUFaLEVBQ0UsUUFBUSxTQUFSLENBQWtCLE1BQWxCLENBQXlCLFNBQXpCLEVBREYsS0FHRSxRQUFRLFNBQVIsSUFBcUIsUUFBUSxTQUFSLEVBQW1CLE9BQW5CLENBQTJCLElBQUksTUFBSixDQUFXLFlBQVksVUFBVSxLQUFWLENBQWdCLEdBQWhCLEVBQXFCLElBQXJCLENBQTBCLEdBQTFCLENBQVosR0FBNkMsU0FBeEQsRUFBbUUsSUFBbkUsQ0FBM0IsRUFBcUcsR0FBckcsQ0FBckI7QUFDSDs7O0FDWkQsU0FBUyxhQUFULENBQXVCLE9BQXZCLEVBQWdDLFNBQWhDLEVBQTJDO0FBQ3pDLE1BQUksT0FBTyxTQUFTLGFBQVQsQ0FBdUIsTUFBdkIsQ0FBWDtBQUNBLE1BQUksUUFBUSxTQUFSLEtBQVEsQ0FBUyxPQUFULEVBQWtCO0FBQzVCLFFBQUksU0FBUyxjQUFiO0FBQ0EsUUFBRyxVQUFRLEdBQVIsR0FBYyxFQUFkLElBQW9CLFVBQVEsR0FBUixHQUFjLEVBQXJDLEVBQXlDO0FBQ3hDLGNBQVEsVUFBUSxFQUFoQjtBQUNFLGFBQUssQ0FBTDtBQUFRLG1CQUFTLGNBQVQsQ0FBeUI7QUFDakMsYUFBSyxDQUFMO0FBQ0EsYUFBSyxDQUFMO0FBQ0EsYUFBSyxD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LFVBQVUsQ0FBVixFQUFhLFNBQWpCLEVBQ0ksVUFBVSxDQUFWLEVBQWEsU0FBYixDQUF1QixHQUF2QixDQUEyQixxQkFBM0IsRUFESixLQUdJLFVBQVUsQ0FBVixFQUFhLFNBQWIsSUFBMEIsc0JBQTFCO0FBQ0osb0JBQVEsS0FBUjtBQUNIO0FBQ0o7QUFDRCxXQUFPLEtBQVA7QUFDSDs7O0FDaEJELFVBQVUsNkJBQVYiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0KVxyXG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XHJcbiAgZWxzZVxyXG4gICAgZWxlbWVudC5jbGFzc05hbWUgKz0gJyAnICsgY2xhc3NOYW1lO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuICBpZiAoZWxlbWVudC5jbGFzc0xpc3QpXHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuICBlbHNlXHJcbiAgICBlbGVtZW50W2NsYXNzTmFtZV0gPSBlbGVtZW50W2NsYXNzTmFtZV0ucmVwbGFjZShuZXcgUmVnRXhwKCcoXnxcXFxcYiknICsgY2xhc3NOYW1lLnNwbGl0KCcgJykuam9pbignfCcpICsgJyhcXFxcYnwkKScsICdnaScpLCAnICcpO1xyXG59IiwiZnVuY3Rpb24gY29uZ3JhdHNDb3VudChjb25ncmF0LCBjb250YWluZXIpIHtcclxuICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICB2YXIgZ3JhbW0gPSBmdW5jdGlvbihjb25ncmF0KSB7XHJcbiAgICB2YXIgc3RyaW5nID0gJ9C/0L7Qt9C00YDQsNCy0LvQtdC90LjQuSc7XHJcbiAgICBpZihjb25ncmF0JTEwMCA8IDExIHx8IGNvbmdyYXQlMTAwID4gMTQpIHtcclxuICAgICBzd2l0Y2ggKGNvbmdyYXQlMTApIHtcclxuICAgICAgIGNhc2UgMTogc3RyaW5nID0gJ9C/0L7Qt9C00YDQsNCy0LvQtdC90LjQtSc7IGJyZWFrO1xyXG4gICAgICAgY2FzZSAyOlxyXG4gICAgICAgY2FzZSAzOlxyXG4gICAgICAgY2FzZSA0OiBzdHJpbmcgPSAn0L/QvtC30LTRgNCw0LLQu9C10L3QuNGPJzsgYnJlYWs7XHJcbiAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0cmluZztcclxuICB9O1xyXG4gIC8vdG9kbyBzZXBhcmF0ZSBzcGFuIGFuZCB3b3JkIFwiZ3JhbW1cIlxyXG4gIHNwYW4uY2xhc3NOYW1lPSAnY29uZ3JhdHMtY291bnQnO1xyXG4gIHNwYW4uaW5uZXJIVE1MID0gY29uZ3JhdCArICcgJyArIGdyYW1tKGNvbmdyYXQpO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGFuKTtcclxufSIsImZ1bmN0aW9uIGNvdW50ZG93bih0b0RhdGUpIHtcclxuICAgIHZhciBmaW5hbCA9ICBuZXcgRGF0ZSh0b0RhdGUpO1xyXG5cclxuICAgIHZhciByZW1haW5lZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHZhciBkaWZmID0gZmluYWwgLSBub3c7XHJcblxyXG4gICAgICAgIHZhciByZW1haW4gPSB7XHJcbiAgICAgICAgICAgIGRheXNSZW1haW46IG51bGwsXHJcbiAgICAgICAgICAgIGhvdXJzUmVtYWluOiBudWxsLFxyXG4gICAgICAgICAgICBtaW51dGVzUmVtYWluOiBudWxsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG1pbnV0ZXMgPSA2MDAwMCxcclxuICAgICAgICAgICAgaG91cnMgPSBtaW51dGVzICo2MCxcclxuICAgICAgICAgICAgZGF5cyA9IGhvdXJzICogMjQ7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxlYWRaZXJvKG51bWJlcikge1xyXG4gICAgICAgICAgICB2YXIgbnVtID0gbnVtYmVyICsgJyc7XHJcbiAgICAgICAgICAgIGlmKG51bS5sZW5ndGggPD0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcwJysgbnVtO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtYWluLmRheXNSZW1haW4gPSBsZWFkWmVybyhNYXRoLmZsb29yKGRpZmYgLyBkYXlzKSk7XHJcbiAgICAgICAgcmVtYWluLmhvdXJzUmVtYWluID0gbGVhZFplcm8oTWF0aC5mbG9vcigoZGlmZiAlIGRheXMpIC8gaG91cnMpKTtcclxuICAgICAgICByZW1haW4ubWludXRlc1JlbWFpbiA9IGxlYWRaZXJvKE1hdGguZmxvb3IoKGRpZmYgJSBob3VycykgLyBtaW51dGVzKSk7XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXlzJykuaW5uZXJUZXh0ID0gcmVtYWluLmRheXNSZW1haW47XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvdXJzJykuaW5uZXJUZXh0ID0gcmVtYWluLmhvdXJzUmVtYWluO1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW51dGVzJykuaW5uZXJUZXh0ID0gcmVtYWluLm1pbnV0ZXNSZW1haW47XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjb3VudGVyID0gc2V0SW50ZXJ2YWwocmVtYWluZWQsIDEwMDApO1xyXG59IiwiOyFmdW5jdGlvbiAoKSB7XHJcbiAgdmFyIHN1Ym1pdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXQnKTtcclxuICB2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtLWNvbmdyYXR1bGF0ZScpO1xyXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8vY291bnRpbmcgc3VibWl0cyA9IG51bWJlciBvZiBjb25ncmF0dWxhdGlvbnNcclxuICAgIHZhciBjb25ncmF0Q291bnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndHJleENvbmdyYXRzJyk7XHJcbiAgICBpZiAoY29uZ3JhdENvdW50ID09PSBudWxsKVxyXG4gICAgICBjb25ncmF0Q291bnQgPSAwO1xyXG4gICAgY29uZ3JhdENvdW50Kys7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndHJleENvbmdyYXRzJywgY29uZ3JhdENvdW50KTtcclxuICAgIC8vc2VuZCBmb3JtXHJcbiAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgcmVxdWVzdC5vcGVuKGZvcm0ubWV0aG9kLCBmb3JtLmFjdGlvbiwgdHJ1ZSk7XHJcbiAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIHJlc3AgPSBudWxsO1xyXG4gICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPj0gMjAwICYmIHJlcXVlc3Quc3RhdHVzIDwgNDAwKSB7XHJcbiAgICAgICAgcmVzcCA9IHJlcXVlc3QucmVzcG9uc2VUZXh0O1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1ib2R5JykuaW5uZXJIVE1MID0gcmVzcDtcclxuICAgICAgICB2YXIgdHJleENvbmdyYXRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZ3JhdHMtY291bnQnKTtcclxuICAgICAgICAvL2NvdW50aW5nIGNvbmdyYXR1bGF0aW9ucyBhbmQgc3RvcmUgaW50byBjb250YWluZXJcclxuICAgICAgICBjb25ncmF0c0NvdW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0cmV4Q29uZ3JhdHMnKSwgdHJleENvbmdyYXRDb250YWluZXIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3cm9uZyByZXF1ZXN0Jyk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdwcm9ibGVtcyBvZiBzb21lIHNvcnQnKTtcclxuICAgIH07XHJcbiAgICAvL3RvZG8gdmFsaWRhdGUgb24ga2V5dXBcclxuICAgIGlmICh2YWxpZGF0aW9uKGZvcm0pKSB7XHJcbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xyXG4gICAgfVxyXG5cclxuICB9KTtcclxufSgpO1xyXG4iLCI7IWZ1bmN0aW9uICgpIHtcclxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKTtcclxuICB2YXIgbW9kYWxPcGVuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLW9wZW4nKTtcclxuICB2YXIgY2xvc2VNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1jbG9zZS1tb2RhbCcpO1xyXG4gIHZhciBkb2NCb2R5ID0gZG9jdW1lbnQuYm9keTtcclxuICBtb2RhbE9wZW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgYWRkQ2xhc3MoZG9jQm9keSwgJ2lzLW1vZGFsLW9wZW4nKTtcclxuICB9KTtcclxuICAvL3RvZG8gY2xvc2UgbW9kYWwgYnkgY2xpY2tpbmcgb3ZlcmxheVxyXG4gIFtdLmZvckVhY2guY2FsbChjbG9zZU1vZGFsQnRuLCBmdW5jdGlvbiAoZWxlbSkge1xyXG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgcmVtb3ZlQ2xhc3MoZG9jQm9keSwgJ2lzLW1vZGFsLW9wZW4nKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KCk7IiwiOyFmdW5jdGlvbiAoKSB7XHJcbiAgdmFyIHNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbGlkZXInKSxcclxuICAgIG5leHRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dCcpLFxyXG4gICAgcHJldkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2JyksXHJcbiAgICBzbGlkZXMgPSBzbGlkZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xpJyksXHJcbiAgICBjb3VudGVyID0gMDtcclxuXHJcbiAgZnVuY3Rpb24gc2hvd0ltYWdlKGluZGV4KSB7XHJcbiAgICBbXS5mb3JFYWNoLmNhbGwoc2xpZGVzLCBmdW5jdGlvbiAoZWxlbSkge1xyXG4gICAgICByZW1vdmVDbGFzcyhlbGVtLCAnc2xpZGVyX19pdGVtLS1hY3RpdmUnKTtcclxuICAgIH0pO1xyXG4gICAgYWRkQ2xhc3Moc2xpZGVzW2luZGV4XSwgJ3NsaWRlcl9faXRlbS0tYWN0aXZlJyk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBuZXh0SW1nKCkge1xyXG4gICAgaWYgKGNvdW50ZXIgPCBzbGlkZXMubGVuZ3RoIC0gMSkge1xyXG4gICAgICBjb3VudGVyICs9IDE7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb3VudGVyID0gMDtcclxuICAgIH1cclxuICAgIHNob3dJbWFnZShjb3VudGVyKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByZXZJbWcoKSB7XHJcbiAgICBpZiAoY291bnRlciA+IDApIHtcclxuICAgICAgY291bnRlciAtPSAxO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY291bnRlciA9IHNsaWRlcy5sZW5ndGggLSAxO1xyXG4gICAgfVxyXG4gICAgc2hvd0ltYWdlKGNvdW50ZXIpO1xyXG4gIH1cclxuXHJcbiAgd2luZG93LnNldEludGVydmFsKHByZXZJbWcsIDYwMDApO1xyXG5cclxuICBuZXh0QnRuLm9uY2xpY2sgPSBuZXh0SW1nO1xyXG4gIHByZXZCdG4ub25jbGljayA9IHByZXZJbWc7XHJcbn0oKTsiLCJmdW5jdGlvbiB2YWxpZGF0aW9uKGZvcm0pIHtcclxuICAgIHZhciBmb3JtQXJyYXkgPSBmb3JtLmVsZW1lbnRzO1xyXG4gICAgdmFyIHZhbGlkID0gdHJ1ZTtcclxuICAgIHZhciBtZXNzYWdlID0gJ9CX0LDQv9C+0LvQvdC40YLQtSDRjdGC0L4g0L/QvtC70LUhJztcclxuICAgIHZhciBlcnJvckNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgZXJyb3JDb250YWluZXIuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBmb3JtQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZihmb3JtQXJyYXlbaV0uaGFzQXR0cmlidXRlKCdyZXF1aXJlZCcpICYmIGZvcm1BcnJheVtpXS52YWx1ZSA9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoZm9ybUFycmF5W2ldLmNsYXNzTGlzdClcclxuICAgICAgICAgICAgICAgIGZvcm1BcnJheVtpXS5jbGFzc0xpc3QuYWRkKCdmb3JtLWlucHV0LS1pbnZhbGlkJyk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGZvcm1BcnJheVtpXS5jbGFzc05hbWUgKz0gJyBmb3JtLWlucHV0LS1pbnZhbGlkJztcclxuICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsaWQ7XHJcbn0iLCJjb3VudGRvd24oJ1NlcHRlbWJlciAyNCwgMjAxNiAyNDowMDowMCcpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
